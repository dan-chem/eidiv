{% load static %}
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Dienst {{ obj.nummer_formatiert }}</title>
  <link rel="stylesheet" href="{% if print_css_url %}{{ print_css_url }}{% else %}{% static 'css/print.css' %}{% endif %}">
  <style>
  :root{
    --muted-100:#f1f5f9;
    --muted-600:#475569;
    --ok-50:#dcfce7;
    --ok-700:#166534;
  }
  h2 { color: #0f172a; margin: 0 0 6px; }
  h3 { color: #0f172a; margin: 8px 0 4px; }
  table { width: 100%; border-collapse: collapse; }
  thead tr { background: var(--muted-100); }
  thead th { color: var(--muted-600); text-align: left; padding: 4px 6px; }
  tbody td { padding: 4px 6px; vertical-align: top; }
  .badge { display:inline-block; padding:2px 6px; font-size:10px; border-radius:4px; font-weight:600; }
  .badge-agt { background: var(--ok-50); color: var(--ok-700); }
</style>
</head>
<body>
<header id="doc-header">
  <h1>Dienstliste</h1>
  <div class="small">
    Nummer: <span class="mono">{{ obj.nummer_formatiert }}</span> |
    Beginn: {{ obj.start_dt|date:"d.m.Y H:i" }} |
    Ende: {{ obj.ende_dt|date:"d.m.Y H:i" }}
  </div>
  <div><strong>Titel:</strong> {{ obj.titel }}</div>
</header>

<section>
  <h2>Beschreibung</h2>
  <div style="white-space: pre-wrap;">{{ obj.beschreibung|default:"—" }}</div>
</section>

<section>
  <h2>Fahrzeuge</h2>
  <table>
    <thead><tr><th>Fahrzeug</th><th>km</th><th>Std.</th></tr></thead>
    <tbody>
      {% for f in obj.dienstfahrzeug_set.all %}
      <tr><td>{{ f.fahrzeug }}</td><td>{{ f.kilometer|default:"—" }}</td><td>{{ f.stunden|default:"—" }}</td></tr>
      {% empty %}
      <tr><td colspan="3">—</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>

<section>
  <h2>Abrollbehälter</h2>
  <table>
    <thead><tr><th>Abrollbehälter</th><th>erforderlich</th></tr></thead>
    <tbody>
      {% for ab in obj.dienstabrollbehaelter_set.all %}
      <tr><td>{{ ab.abrollbehaelter }}</td><td>{{ ab.erforderlich|yesno:"Ja,Nein" }}</td></tr>
      {% empty %}
      <tr><td colspan="2">—</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>

<section>
  <h2>Anhänger</h2>
  <table>
    <thead><tr><th>Anhänger</th><th>km</th><th>Std.</th></tr></thead>
    <tbody>
      {% for a in obj.dienstanhaenger_set.all %}
      <tr><td>{{ a.anhaenger }}</td><td>{{ a.kilometer|default:"—" }}</td><td>{{ a.stunden|default:"—" }}</td></tr>
      {% empty %}
      <tr><td colspan="3">—</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>

<!-- Teilnehmende -->
<section>
  <h2>Teilnehmende</h2>

  <!-- Aktive -->
  <h3>Aktive</h3>
  <table class="table table-sm w-100">
    <thead>
      <tr>
        <th style="text-align:left;">Mitglied</th>
        <th style="text-align:left;">Fahrzeug/Funktion</th>
        <th style="text-align:right;">AGT (Min)</th>
      </tr>
    </thead>
    <tbody>
      {% for t in obj.dienstteilnahme_set.all %}
        {% if not t.mitglied.jugendfeuerwehr %}
          <tr>
            <td>{{ t.mitglied.name }}, {{ t.mitglied.vorname }}{% if t.mitglied.agt %} (AGT){% endif %}</td>
            <td>{{ t.fahrzeug_funktion|default:"—" }}</td>
            <td style="text-align:right;">{{ t.agt_minuten|default:"—" }}</td>
          </tr>
        {% endif %}
      {% endfor %}
    </tbody>
  </table>

  <!-- Jugendfeuerwehr -->
  <h3 style="margin-top:10px;">Jugendfeuerwehr</h3>
  <table class="table table-sm w-100">
    <thead>
      <tr>
        <th style="text-align:left;">Mitglied</th>
        <th style="text-align:left;">Fahrzeug/Funktion</th>
        <th style="text-align:right;">AGT (Min)</th>
      </tr>
    </thead>
    <tbody>
      {% for t in obj.dienstteilnahme_set.all %}
        {% if t.mitglied.jugendfeuerwehr %}
          <tr>
            <td>{{ t.mitglied.name }}, {{ t.mitglied.vorname }}{% if t.mitglied.agt %} (AGT){% endif %}</td>
            <td>{{ t.fahrzeug_funktion|default:"—" }}</td>
            <td style="text-align:right;">{{ t.agt_minuten|default:"—" }}</td>
          </tr>
        {% endif %}
      {% endfor %}
    </tbody>
  </table>
</section>

<section>
  <h2>Statistik</h2>
  <div class="grid-3">
    <div><strong>Dauer (h):</strong> {{ obj.dauer_stunden }}</div>
    <div><strong>Gesamtstunden:</strong> {{ obj.gesamtstunden }}</div>
    <div><strong>Teilnehmende:</strong> {{ obj.teilnehmer_anzahl }}</div>
    <div><strong>Hauptamtlich:</strong> {{ obj.teilnehmer_hauptamtlich }}</div>
    <div><strong>Ehrenamtlich:</strong> {{ obj.teilnehmer_ehrenamtlich }}</div>
    <div><strong>km gesamt (Fzg+Anh):</strong> {{ obj.summe_kilometer }}</div>
    <div><strong>Std. Fzg+Anh gesamt:</strong> {{ obj.summe_fahrzeugstunden }}</div>
  </div>
</section>


<footer class="small">
  Unterschrift, Datum
</footer>
</body>
</html>
